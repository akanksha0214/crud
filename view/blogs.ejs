<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("./partials/head") %>
        <title>
            <%= blog.title %>
        </title>

        <style>
            .container-narrow {
                max-width: 780px;
                margin: auto;
            }

            .blog-cover {
                width: 100%;
                height: 420px;
                object-fit: cover;
                border-radius: 14px;
                margin-bottom: 28px;
            }

            .blog-title {
                font-size: 2.4rem;
                font-weight: 800;
                line-height: 1.28;
                letter-spacing: -0.02rem;
                margin-bottom: 12px;
            }

            .blog-body {
                white-space: pre-wrap;
                line-height: 1.75;
                font-size: 1.1rem;
                margin: 24px 0;
                color: #2a2a2a;
            }

            .author-box {
                display: flex;
                align-items: center;
                gap: 14px;
                margin-bottom: 20px;
            }

            .avatar {
                width: 52px;
                height: 52px;
                border-radius: 50%;
                object-fit: cover;
            }

            .meta {
                font-size: 0.9rem;
                color: #666;
            }

            .tag {
                background: #f1f3f5;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.85rem;
                margin-right: 6px;
            }

            .comment-card {
                border-bottom: 1px solid #eee;
                padding: 14px 0;
            }

            .comment-author {
                font-weight: 600;
                margin-right: 6px;
            }

            .comment-content {
                white-space: pre-wrap;
                margin-top: 4px;
                font-size: 0.95rem;
            }

            .comment-box {
                border: 1px solid #ddd;
                border-radius: 10px;
                padding: 14px;
            }

            textarea.comment-input {
                width: 100%;
                height: 100px;
                border: none;
                resize: vertical;
                outline: none;
            }
        </style>
</head>

<body>

    <%- include("./partials/nav") %>

        <div class="container-narrow py-4">

            <!-- Title -->
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="blog-title mb-0">
                    <%= blog.title %>
                </h1>

                <% if (user && user.role==="ADMIN" ) { %>
                    <form action="/blog/<%= blog._id %>/delete" method="POST">
                        <button class="btn btn-danger btn-sm">Delete</button>
                    </form>
                    <% } %>
            </div>

            <!-- Author & Meta -->
            <div class="author-box">
                <img src="<%= blog.createdby.image %>" class="avatar" />
                <div>
                    <div><strong>
                            <%= blog.createdby.first_name %>
                        </strong></div>
                    <div class="meta">
                        <%= new Date(blog.createdAt).toLocaleDateString('en-US', { year: 'numeric' , month: 'short' ,
                            day: 'numeric' }) %>
                    </div>
                </div>
            </div>
            <!-- Cover -->
            <img src="/<%= blog.coverimg %>" class="blog-cover" />

            <!-- Body -->
            <div class="blog-body">
                <%= blog.body %>
            </div>

            <!-- Comment Form -->
            <% if (user) { %>
                <div class="mt-5 mb-4">
                    <h5 class="fw-semibold mb-2">Leave a comment</h5>
                    <form action="/blog/comment/<%= blog._id %>" method="POST" class="comment-box">
                        <textarea class="comment-input" name="content" placeholder="Write a comment..."></textarea>
                        <button type="submit" class="btn btn-dark btn-sm mt-2">Post Comment</button>
                    </form>
                </div>
                <% } %>

                    <!-- Comments -->
                    <div class="mt-4 mb-5">
                        <h5 class="fw-semibold mb-3">Comments (<%= comments.length %>)</h5>

                        <% comments.forEach(comment=> { %>
                            <div class="comment-card">
                                <div>
                                    <span class="comment-author">
                                        <%= comment.createdBy.first_name %>
                                    </span>
                                    <span class="meta">
                                        â€” <%= new Date(comment.createdAt).toLocaleDateString('en-US', { year: 'numeric'
                                            , month: 'short' , day: 'numeric' }) %>
                                    </span>
                                </div>
                                <div class="comment-content">
                                    <%= comment.content %>
                                </div>
                            </div>
                            <% }) %>
                    </div>

        </div>

        <%- include("./partials/script") %>
</body>

</html>